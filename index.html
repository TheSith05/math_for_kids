<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –¥–µ—Ç–µ–π</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-200">
  <div class="min-h-screen p-2 sm:p-4 flex flex-col items-center bg-gradient-to-b from-blue-200 to-green-200">
    <div class="grid gap-4 mb-4" id="level-buttons">
      <button class="px-4 py-2 rounded-full text-white font-bold bg-blue-600 hover:bg-blue-500 transition-transform transform hover:scale-105" data-level="1">–£—Ä–æ–≤–µ–Ω—å 1</button>
      <button class="px-4 py-2 rounded-full text-white font-bold bg-blue-400 hover:bg-blue-500 transition-transform transform hover:scale-105" data-level="2">–£—Ä–æ–≤–µ–Ω—å 2</button>
      <button class="px-4 py-2 rounded-full text-white font-bold bg-blue-400 hover:bg-blue-500 transition-transform transform hover:scale-105" data-level="3">–£—Ä–æ–≤–µ–Ω—å 3</button>
      <button class="px-4 py-2 rounded-full text-white font-bold bg-blue-400 hover:bg-blue-500 transition-transform transform hover:scale-105" data-level="4">–£—Ä–æ–≤–µ–Ω—å 4</button>
      <button class="px-4 py-2 rounded-full text-white font-bold bg-blue-400 hover:bg-blue-500 transition-transform transform hover:scale-105" data-level="5">–£—Ä–æ–≤–µ–Ω—å 5</button>
    </div>
    <div id="faq-button" class="absolute top-4 left-4 text-2xl cursor-pointer">‚ùì</div>
    <div id="faq-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white p-6 rounded-lg max-w-md w-full">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold">–û –∏–≥—Ä–µ</h2>
          <span id="faq-close" class="text-xl cursor-pointer">‚úñ</span>
        </div>
        <p class="mb-2"><strong>–£—Ä–æ–≤–µ–Ω—å 1:</strong> –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã (1‚Äì10), —Å–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ, –±–µ–∑ —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–π.</p>
        <p class="mb-2"><strong>–£—Ä–æ–≤–µ–Ω—å 2:</strong> –ß–∏—Å–ª–∞ 1‚Äì20, —Å–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ, —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ —á–∏—Å–ª–∞.</p>
        <p class="mb-2"><strong>–£—Ä–æ–≤–µ–Ω—å 3:</strong> –¢—Ä–∏ —á–∏—Å–ª–∞ (1‚Äì20, 1‚Äì10), –¥–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ —á–∏—Å–ª–∞.</p>
        <p class="mb-2"><strong>–£—Ä–æ–≤–µ–Ω—å 4:</strong> –ß–∏—Å–ª–∞ 1‚Äì20, —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ 10.</p>
        <p class="mb-2"><strong>–£—Ä–æ–≤–µ–Ω—å 5:</strong> –¢—Ä–∏ —á–∏—Å–ª–∞, —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ —á–∏—Å–ª–∞, —Å–ª–æ–∂–µ–Ω–∏–µ/–≤—ã—á–∏—Ç–∞–Ω–∏–µ.</p>
        <p class="mt-4"><strong>–ù–æ–≤–∞—è –∏–≥—Ä–∞:</strong> –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ <code>250989</code> –∏ –Ω–∞–∂–º–∏—Ç–µ "–í–≤–æ–¥" –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.</p>
      </div>
    </div>
    <div id="avatar-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white p-6 rounded-lg max-w-md w-full">
        <h2 class="text-2xl font-bold mb-4">–í—ã–±–µ—Ä–∏ –∞–≤–∞—Ç–∞—Ä–∫—É</h2>
        <div id="avatar-options" class="grid grid-cols-3 gap-4"></div>
      </div>
    </div>
    <div id="star-count" class="absolute top-4 right-4 flex flex-col items-center">
      <span class="text-2xl">‚≠ê</span>
      <span id="star-number" class="text-xl font-bold">0</span>
    </div>
    <div class="flex items-center justify-center mb-4">
      <div id="cat" class="text-6xl mr-4">üò∫</div>
      <div id="crit-counter" class="text-xl font-bold">üò∏ 0/7</div>
    </div>
    <div id="example" class="text-4xl font-bold mb-4" style="font-size: 36px;"></div>
    <div class="flex items-center justify-center w-full mt-8 mb-4">
      <div class="flex flex-col items-center mr-4">
        <div id="enemy" class="text-4xl mb-2">ü¶Å</div>
        <div id="enemy-hp" class="w-20 h-4 bg-gray-300 rounded-full overflow-hidden">
          <div id="enemy-hp-bar" class="h-full bg-red-500" style="width: 100%;"></div>
        </div>
      </div>
      <div id="answer" class="text-2xl mx-4 w-32 text-center">–û—Ç–≤–µ—Ç: </div>
      <div class="flex flex-col items-center ml-4">
        <div id="player" class="text-4xl mb-2">üê∂</div>
        <div id="player-hp" class="w-20 h-4 bg-gray-300 rounded-full overflow-hidden">
          <div id="player-hp-bar" class="h-full bg-green-500" style="width: 100%;"></div>
        </div>
      </div>
    </div>
    <div class="grid grid-cols-3 gap-2 w-80" id="input-buttons">
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">1</button>
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">2</button>
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">3</button>
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">4</button>
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">5</button>
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">6</button>
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">7</button>
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">8</button>
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">9</button>
      <button class="bg-yellow-400 hover:bg-yellow-500 text-3xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105">0</button>
      <button id="submit" class="bg-green-500 hover:bg-green-600 text-2xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105 flex justify-center items-center">–í–≤–æ–¥</button>
      <button id="clear" class="bg-red-500 hover:bg-red-600 text-xl font-bold p-4 rounded-lg transition-transform transform hover:scale-105 flex justify-center items-center">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
  </div>

  <script>
    let level = 1;
    let example = {};
    let answer = '';
    let codeInput = '';
    let stars = localStorage.getItem('stars') || 0;
    let correctCount = 0;
    let streak = 0;
    let playerHP = 100;
    let enemyHP = 80;
    let enemyHPMultiplier = 1.0;
    let currentEnemyIndex = 0;
    let playerAvatar = localStorage.getItem('playerAvatar') || 'üê∂';
    const playerAvatars = ['üê∂', 'üê±', 'üê∞', 'ü¶ù', 'üê∏', 'üï∑Ô∏è'];
    const enemies = [
      { emoji: 'ü¶Å', baseHP: 80 },
      { emoji: 'üê∫', baseHP: 100 },
      { emoji: 'üêª', baseHP: 120 },
      { emoji: 'ü¶ä', baseHP: 90 },
      { emoji: 'üêç', baseHP: 150 }
    ];

    function generateExample() {
      let num1, num2, num3, op1, op2, result, decomposition;
      if (level === 1) {
        num1 = Math.floor(Math.random() * 10) + 1;
        op1 = Math.random() > 0.5 ? '+' : '-';
        num2 = Math.floor(Math.random() * (op1 === '-' ? num1 : 10 - num1 + 1)) + 1;
        result = op1 === '+' ? num1 + num2 : num1 - num2;
      } else if (level === 2) {
        num1 = Math.floor(Math.random() * 20) + 1;
        op1 = Math.random() > 0.5 ? '+' : '-';
        num2 = Math.floor(Math.random() * (op1 === '-' ? num1 : 10)) + 1;
        result = op1 === '+' ? num1 + num2 : num1 - num2;
        if (result > 20) return generateExample();
        decomposition = decomposeNumber(num2, op1, num1);
      } else if (level === 3) {
        num1 = Math.floor(Math.random() * 20) + 1;
        op1 = Math.random() > 0.5 ? '+' : '-';
        num2 = Math.floor(Math.random() * (op1 === '-' ? num1 : 10)) + 1;
        const tempResult = op1 === '+' ? num1 + num2 : num1 - num2;
        if (tempResult < 0) return generateExample();
        num3 = Math.floor(Math.random() * 10) + 1;
        op2 = Math.random() > 0.5 ? '+' : '-';
        result = op2 === '+' ? tempResult + num3 : tempResult - num3;
        if (result > 20) return generateExample();
        decomposition = decomposeNumber(num2, op1, num1);
      } else if (level === 4) {
        op1 = Math.random() > 0.5 ? '+' : '-';
        if (op1 === '-') {
          num1 = Math.floor(Math.random() * 10) + 11;
          const part1 = num1 - 10;
          const part2 = Math.floor(Math.random() * (10 - part1)) + 1;
          num2 = part1 + part2;
          result = num1 - num2;
        } else {
          num1 = Math.floor(Math.random() * 9) + 1;
          const part1 = 10 - num1;
          const part2 = Math.floor(Math.random() * (10 - part1)) + 1;
          num2 = part1 + part2;
          result = num1 + num2;
        }
        if (result > 20) return generateExample();
        decomposition = decomposeNumber(num2, op1, num1);
        if (!decomposition) return generateExample();
      } else if (level === 5) {
        op1 = Math.random() > 0.5 ? '+' : '-';
        if (op1 === '-') {
          num1 = Math.floor(Math.random() * 10) + 11;
          const part1 = num1 - 10;
          const part2 = Math.floor(Math.random() * (10 - part1)) + 1;
          num2 = part1 + part2;
          const tempResult = num1 - num2;
          num3 = Math.floor(Math.random() * 10) + 1;
          op2 = Math.random() > 0.5 ? '+' : '-';
          result = op2 === '+' ? tempResult + num3 : tempResult - num3;
        } else {
          num1 = Math.floor(Math.random() * 9) + 1;
          const part1 = 10 - num1;
          const part2 = Math.floor(Math.random() * (10 - part1)) + 1;
          num2 = part1 + part2;
          const tempResult = num1 + num2;
          num3 = Math.floor(Math.random() * 10) + 1;
          op2 = Math.random() > 0.5 ? '+' : '-';
          result = op2 === '+' ? tempResult + num3 : tempResult - num3;
        }
        if (result > 20) return generateExample();
        decomposition = decomposeNumber(num2, op1, num1);
        if (!decomposition) return generateExample();
      }
      if (result < 0) return generateExample();
      return { num1, num2, num3, op1, op2, result, decomposition };
    }

    function decomposeNumber(num, op1, num1) {
      if (num <= 1) return null;
      if (op1 === '-') {
        const part1 = num1 - 10;
        if (part1 <= 0 || part1 >= num) return null;
        const part2 = num - part1;
        if (part2 <= 0) return null;
        return [part1, part2];
      } else if (op1 === '+') {
        const part1 = 10 - num1;
        if (part1 <= 0 || part1 >= num || num1 + num < 10) return null;
        const part2 = num - part1;
        if (part2 <= 0) return null;
        return [part1, part2];
      }
      return null;
    }

    function showDamage(targetId, damage, color) {
      const target = document.getElementById(targetId);
      const damageText = document.createElement('span');
      damageText.textContent = `-üí•${damage}`;
      damageText.className = `absolute text-${color}-500 text-xl font-bold`;
      target.parentNode.appendChild(damageText);
      const targetRect = target.getBoundingClientRect();
      damageText.style.left = `${targetRect.left + targetRect.width / 2 - damageText.offsetWidth / 2}px`;
      damageText.style.top = `${targetRect.top}px`;
      gsap.to(damageText, {
        y: -50,
        scale: 1.7,
        opacity: 0,
        duration: 0.7,
        ease: 'power2.out',
        onComplete: () => damageText.remove()
      });
    }

    function showBonus(targetId, value, color) {
      const target = document.getElementById(targetId);
      const bonusText = document.createElement('span');
      bonusText.textContent = `+${value}`;
      bonusText.className = `absolute text-${color}-500 text-xl font-bold`;
      target.parentNode.appendChild(bonusText);
      const targetRect = target.getBoundingClientRect();
      bonusText.style.left = `${targetRect.left + targetRect.width / 2 - bonusText.offsetWidth / 2}px`;
      bonusText.style.top = `${targetRect.top}px`;
      gsap.to(bonusText, {
        y: -50,
        scale: 1.7,
        opacity: 0,
        duration: 0.7,
        ease: 'power2.out',
        onComplete: () => bonusText.remove()
      });
    }

    function resetGame() {
      localStorage.clear();
      stars = 0;
      correctCount = 0;
      streak = 0;
      playerHP = 100;
      enemyHP = Math.round(enemies[currentEnemyIndex].baseHP * enemyHPMultiplier);
      currentEnemyIndex = 0;
      enemyHPMultiplier = 1.0;
      document.getElementById('enemy').textContent = enemies[currentEnemyIndex].emoji;
      document.getElementById('star-number').textContent = '0';
      document.getElementById('crit-counter').textContent = 'üò∏ 0/7';
      document.getElementById('player-hp-bar').style.width = '100%';
      document.getElementById('enemy-hp-bar').style.width = '100%';
      document.getElementById('cat').textContent = 'üò∫';
      gsap.to('#cat', {
        scale: 1.5,
        rotation: 360,
        duration: 1,
        ease: 'elastic',
        onComplete: () => gsap.set('#cat', { scale: 1, rotation: 0 })
      });
      codeInput = '';
      answer = '';
      document.getElementById('answer').textContent = '–û—Ç–≤–µ—Ç: ';
      const avatarModal = document.getElementById('avatar-modal');
      const avatarOptions = document.getElementById('avatar-options');
      avatarOptions.innerHTML = '';
      playerAvatars.forEach(avatar => {
        const btn = document.createElement('button');
        btn.textContent = avatar;
        btn.className = 'text-4xl p-2 rounded-lg hover:bg-gray-200';
        btn.addEventListener('click', () => {
          playerAvatar = avatar;
          localStorage.setItem('playerAvatar', avatar);
          document.getElementById('player').textContent = avatar;
          avatarModal.classList.add('hidden');
          updateExample();
        });
        avatarOptions.appendChild(btn);
      });
      avatarModal.classList.remove('hidden');
    }

    function updateExample() {
      example = generateExample();
      const exampleDiv = document.getElementById('example');
      exampleDiv.innerHTML = `
        ${example.num1} ${example.op1} <span id="num2" class="inline-block ${example.decomposition ? 'text-gray-400' : 'text-black'}">${example.num2}</span>
        ${level >= 3 ? ` ${example.op2} ${example.num3}` : ''} = ?
      `;
      if (level >= 2 && example.decomposition) {
        exampleDiv.innerHTML += `
          <div class="flex justify-center mt-2">
            <div class="flex flex-col items-center">
              <svg id="brace" width="100" height="50" viewBox="0 0 100 50" class="mt-0" style="position: absolute; transform: scale(1.2);">
                <defs>
                  <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color: #ff6b6b; stop-opacity: 1" />
                    <stop offset="100%" style="stop-color: #ffcc00; stop-opacity: 1" />
                  </linearGradient>
                </defs>
                <polyline points="30,40 50,17 70,40" fill="none" stroke="url(#grad)" stroke-width="4" filter="drop-shadow(2px 2px 2px rgba(0,0,0,0.3))" />
              </svg>
              <span id="decomp1" class="text-xl font-bold decomp" style="position: absolute;">${example.decomposition[0]}</span>
              <span id="decomp2" class="text-xl font-bold decomp" style="position: absolute;">${example.decomposition[1]}</span>
            </div>
          </div>
        `;
      }
      positionBrace();
      if (level >= 2 && example.decomposition) {
        gsap.fromTo('#brace', { scaleY: 0, opacity: 0 }, { scaleY: 1.2, opacity: 1, duration: 0.5, ease: 'bounce' });
        gsap.fromTo('.decomp', { opacity: 0, y: 10 }, { opacity: 1, y: 0, duration: 0.5, delay: 0.3 });
      }
    }

    function positionBrace() {
      if (level === 1 || !example.decomposition) return;
      const num2 = document.getElementById('num2');
      const exampleDiv = document.getElementById('example');
      const brace = document.getElementById('brace');
      const decomp1 = document.getElementById('decomp1');
      const decomp2 = document.getElementById('decomp2');
      const num2Rect = num2.getBoundingClientRect();
      const exampleRect = exampleDiv.getBoundingClientRect();
      const svgWidth = 120;
      const exampleLeft = (window.innerWidth - exampleRect.width) / 2;
      const num2CenterX = num2Rect.left + num2Rect.width;
      const adjustment = num2.textContent.length > 1 && window.innerWidth < 640 ? -7 : num2.textContent.length > 1 ? -5 : 0;
      const svgLeft = num2CenterX + adjustment - svgWidth / 2;
      brace.style.left = `${svgLeft}px`;
      const num2Top = num2Rect.top;
      const desiredTop = num2Top + 50;
      brace.style.top = `${desiredTop - 20.4}px`;
      const braceRect = brace.getBoundingClientRect();
      decomp1.style.left = `${braceRect.left + 30}px`;
      decomp2.style.left = `${braceRect.left + 78}px`;
      decomp1.style.top = `${braceRect.top + 48}px`;
      decomp2.style.top = `${braceRect.top + 48}px`;
    }

    document.getElementById('faq-button').addEventListener('click', () => {
      document.getElementById('faq-modal').classList.toggle('hidden');
    });
    document.getElementById('faq-close').addEventListener('click', () => {
      document.getElementById('faq-modal').classList.add('hidden');
    });

    document.getElementById('input-buttons').addEventListener('click', (event) => {
      if (event.target.tagName !== 'BUTTON') return;
      const value = event.target.textContent;
      if (value === '–í–≤–æ–¥') {
        if (codeInput === '250989') {
          resetGame();
        } else if (!isNaN(parseInt(answer)) && parseInt(answer) === example.result) {
          streak++;
          correctCount++;
          const damage = correctCount >= 7 ? 2 * (10 + 5 * level) : 10 + 5 * level;
          const color = correctCount >= 7 ? 'orange' : 'red';
          let starReward = level <= 2 ? 1 : level <= 4 ? 2 : 3;
          if (correctCount >= 7) {
            starReward += 5;
            gsap.to('#cat', {
              scale: 1.5,
              rotation: 360,
              duration: 1,
              ease: 'elastic',
              onComplete: () => gsap.set('#cat', { scale: 1, rotation: 0 })
            });
            correctCount = 0;
          }
          document.getElementById('crit-counter').textContent = `üò∏ ${correctCount}/7`;
          console.log(`Damage: ${damage}, Enemy HP before: ${enemyHP}`);
          enemyHP = Math.max(0, enemyHP - damage);
          console.log(`Enemy HP after: ${enemyHP}`);
          document.getElementById('enemy-hp-bar').style.width = `${(enemyHP / (enemies[currentEnemyIndex].baseHP * enemyHPMultiplier)) * 100}%`;
          gsap.to('#enemy', {
            x: '+=5',
            y: -5,
            scale: 0.95,
            rotation: 5,
            duration: 0.1,
            yoyo: true,
            repeat: 6,
            onComplete: () => gsap.set('#enemy', { x: 0, y: 0, scale: 1, rotation: 0 })
          });
          showDamage('enemy', damage, color);
          document.getElementById('cat').textContent = 'üò∏';
          gsap.to('#cat', {
            y: -30,
            scale: 1.2,
            duration: 0.5,
            yoyo: true,
            repeat: 1,
            onComplete: () => gsap.set('#cat', { y: 0, scale: 1 })
          });
          stars += starReward;
          localStorage.setItem('stars', stars);
          document.getElementById('star-number').textContent = stars;
          gsap.to('#star-count', { scale: 1.2, duration: 0.3, yoyo: true, repeat: 1 });
          if (enemyHP <= 0) {
            currentEnemyIndex = (currentEnemyIndex + 1) % enemies.length;
            enemyHP = Math.round(enemies[currentEnemyIndex].baseHP * enemyHPMultiplier);
            document.getElementById('enemy').textContent = enemies[currentEnemyIndex].emoji;
            document.getElementById('enemy-hp-bar').style.width = '100%';
            gsap.to('#enemy', { opacity: 0, duration: 0.3, onComplete: () => {
              gsap.to('#enemy', { opacity: 1, duration: 0.3 });
            }});
            if (currentEnemyIndex === 0) {
              enemyHPMultiplier += 0.1;
              playerHP = 100;
              document.getElementById('player-hp-bar').style.width = '100%';
              showBonus('player', 100, 'green');
              stars += 10;
              localStorage.setItem('stars', stars);
              document.getElementById('star-number').textContent = stars;
            }
          }
          answer = '';
          codeInput = '';
          document.getElementById('answer').textContent = '–û—Ç–≤–µ—Ç: ';
          updateExample();
        } else {
          streak = 0;
          correctCount = 0;
          const damage = 10;
          playerHP = Math.max(0, playerHP - damage);
          document.getElementById('player-hp-bar').style.width = `${playerHP}%`;
          gsap.to('#player', {
            x: '+=5',
            y: -5,
            scale: 0.95,
            rotation: 5,
            duration: 0.1,
            yoyo: true,
            repeat: 6,
            onComplete: () => gsap.set('#player', { x: 0, y: 0, scale: 1, rotation: 0 })
          });
          showDamage('player', damage, 'purple');
          document.getElementById('cat').textContent = 'üòø';
          gsap.to('#cat', {
            x: -15,
            rotation: 5,
            duration: 0.2,
            yoyo: true,
            repeat: 3,
            onComplete: () => gsap.set('#cat', { x: 0, rotation: 0 })
          });
          stars = Math.max(0, stars - 1);
          localStorage.setItem('stars', stars);
          document.getElementById('star-number').textContent = stars;
          document.getElementById('crit-counter').textContent = `üò∏ ${correctCount}/7`;
          if (playerHP <= 0) {
            resetGame();
          }
          answer = '';
          codeInput = '';
          document.getElementById('answer').textContent = '–û—Ç–≤–µ—Ç: ';
        }
      } else if (value === '–û—á–∏—Å—Ç–∏—Ç—å') {
        answer = '';
        codeInput = '';
        document.getElementById('answer').textContent = '–û—Ç–≤–µ—Ç: ';
      } else {
        answer += value;
        codeInput += value;
        document.getElementById('answer').textContent = `–û—Ç–≤–µ—Ç: ${answer}`;
      }
    });

    document.getElementById('level-buttons').addEventListener('click', (event) => {
      if (event.target.tagName !== 'BUTTON') return;
      level = parseInt(event.target.dataset.level);
      document.querySelectorAll('#level-buttons button').forEach(btn => {
        btn.classList.remove('bg-blue-600');
        btn.classList.add('bg-blue-400');
      });
      event.target.classList.remove('bg-blue-400');
      event.target.classList.add('bg-blue-600');
      answer = '';
      codeInput = '';
      document.getElementById('answer').textContent = '–û—Ç–≤–µ—Ç: ';
      updateExample();
    });

    function updateButtonLayout() {
      const container = document.getElementById('level-buttons');
      const buttons = container.querySelectorAll('button');
      const containerWidth = container.getBoundingClientRect().width;
      const buttonWidth = buttons[0].getBoundingClientRect().width;
      const gap = 16;
      const maxButtonsPerRow = Math.floor((containerWidth + gap) / (buttonWidth + gap));
      container.classList.remove('grid-cols-1', 'grid-cols-2', 'grid-cols-4', 'grid-cols-5');
      buttons.forEach(btn => {
        btn.classList.remove('col-span-2', 'col-span-1');
      });
      if (buttons.length === 4) {
        if (window.innerWidth < 640) {
          container.classList.add('grid-cols-2');
          buttons[2].classList.add('col-span-2');
          buttons[3].classList.add('col-span-2');
        } else {
          container.classList.add('grid-cols-4');
        }
      } else if (buttons.length === 5) {
        if (window.innerWidth < 640) {
          container.classList.add('grid-cols-2');
          buttons[4].classList.add('col-span-2');
        } else {
          container.classList.add('grid-cols-5');
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('star-number').textContent = stars;
      document.getElementById('enemy').textContent = enemies[currentEnemyIndex].emoji;
      document.getElementById('crit-counter').textContent = 'üò∏ 0/7';
      document.getElementById('player').textContent = playerAvatar;
      updateExample();
      updateButtonLayout();
    });

    window.addEventListener('resize', () => {
      positionBrace();
      updateButtonLayout();
    });
  </script>
</body>
</html>
